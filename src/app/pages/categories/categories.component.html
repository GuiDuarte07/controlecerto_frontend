<section class="registration-container">
  <div class="flex w-full justify-between items-center !mb-4">
    <h2 class="text-2xl font-bold text-slate-700 tracking-wide">Categorias</h2>

    <app-register-button
      title="Categoria"
      (clickEvent)="openCategoryDialog()"
    ></app-register-button>
  </div>
  <div class="flex flex-col w-full gap-2">
    <mat-tab-group>
      <mat-tab label="Despesas">
        <ng-container
          *ngTemplateOutlet="
            categoriesList;
            context: { categoriesType: 'expense' }
          "
        ></ng-container>
      </mat-tab>
      <mat-tab label="Receitas">
        <ng-container
          *ngTemplateOutlet="
            categoriesList;
            context: { categoriesType: 'income' }
          "
        ></ng-container>
      </mat-tab>
    </mat-tab-group>
  </div>
</section>

<ng-template #categoriesList let-categoriesType="categoriesType">
  <ul class="overflow-x-hidden">
    @for(category of categoriesType === "expense" ? expenseCategories :
    incomeCategories; track category) {
    <li class="w-full border-0 border-b border-solid border-slate-200">
      <button
        (click)="toggleSideBarCategory(category)"
        class="border-none bg-transparent relative px-2 py-2 flex items-center gap-4 group"
      >
        <div
          [ngStyle]="{ 'background-color': category.color }"
          class="text-white rounded-full w-8 h-8 flex items-center justify-center"
        >
          <span class="material-symbols-outlined !text-base">
            {{ category.icon }}
          </span>
        </div>

        <p class="text-sm text-slate-800 group-hover:font-medium">
          {{ category.name }}
        </p>
      </button>

      <div class=".sub-category-list-container">
        @for(subCategory of category.subCategories; track subCategory) {
        <button
          (click)="openCategoryDialog(subCategory)"
          class="!ml-10 border-none bg-transparent !pb-2 !py-2 flex items-center gap-4 group"
        >
          <div
            [ngStyle]="{ 'background-color': subCategory.color }"
            class="text-white rounded-full w-8 h-8 flex items-center justify-center"
          >
            <span class="material-symbols-outlined !text-base">
              {{ subCategory.icon }}
            </span>
          </div>

          <p class="text-sm text-slate-800 group-hover:font-medium">
            {{ subCategory.name }}
          </p>
        </button>
        }
      </div>
    </li>
    }
  </ul>
</ng-template>

<p-sidebar
  [(visible)]="categorySideBarOpen"
  position="bottom"
  styleClass="h-[300px] !px-64 !pb-8"
>
  <div class="grid grid-cols-3">
    <div class="flex flex-col gap-2 items-center">
      <div
        [ngStyle]="{ 'background-color': selectedCategory?.color }"
        class="text-white rounded-full w-20 h-20 flex items-center justify-center"
      >
        <span class="material-symbols-outlined !text-3xl">
          {{ selectedCategory?.icon }}
        </span>
      </div>

      <p class="text-slate-800 text-xl font-medium">
        {{ selectedCategory?.name }}
      </p>

      <!-- <button pButton pRipple label="Editar" ></button> -->
    </div>

    <div class="flex flex-col gap-3">
      <div class="">
        <p class="">Limite mensal <span>R$ 434.00</span></p>
        <p class="">Total gasto esse mÃªs <span>R$ 434.00</span></p>
      </div>
      <p-buttonGroup>
        <p-button
          label="Editar"
          icon="pi pi-pen-to-square"
          (onClick)="openCategoryDialog(this.selectedCategory!)"
        />
        <p-button label="Deletar" icon="pi pi-trash" />
        <p-button label="Cancelar" icon="pi pi-times" />
      </p-buttonGroup>
    </div>

    <div class="">
      <p class="">Sub-Categorias</p>
      <ul class="p-0 ml-12 list-disc">
        @for(sb of listSubCategories(selectedCategory); track sb) {
          <li>{{sb}}</li>
        }
      </ul>
    </div>
  </div>
</p-sidebar>

<app-category-dialog #categoryDialog></app-category-dialog>
